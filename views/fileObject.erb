<?xml version="1.0" encoding="UTF-8"?>

<premis xmlns="info:lc/xmlns/premis-v2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="2.0">
	<% unless @result.fileObject.nil? %>
	<!-- generate premis file object -->
	<object xsi:type="file">
		<objectIdentifier>
			<objectIdentifierType>DAITSS</objectIdentifierType>
			<objectIdentifierValue><%= @result.fileObject.url %></objectIdentifierValue>
		</objectIdentifier>
		<objectCharacteristics>
			<compositionLevel><%= @result.fileObject.compositionLevel %></compositionLevel>
			<size><%= @result.fileObject.size %></size>
			<format>
				<% if @result.fileObject.formatName %>
				<formatDesignation>
					<formatName><%= @result.fileObject.formatName %></formatName>
					<% unless @result.fileObject.formatVersion.nil? %>
					<formatVersion><%= @result.fileObject.formatVersion %></formatVersion>
					<% end %>
				</formatDesignation>
				<% end %>
				<% unless @result.fileObject.registryKey.nil? %>
				<formatRegistry>
					<formatRegistryName><%= @result.fileObject.registryName %></formatRegistryName>
					<formatRegistryKey><%= @result.fileObject.registryKey %></formatRegistryKey>
				</formatRegistry>	
				<% end %>
			</format>
			<% unless @result.fileObject.profiles.nil? %>
			<format>
				<formatDesignation>
					<% @result.fileObject.profiles.each do |profile| %>
					<formatName><%= profile %></formatName>
					<% end %>
				</formatDesignation>
			</format>
			<% end %>
			<% unless @result.fileObject.createAppName.nil? %> 
			<creatingApplication>
				<creatingApplicationName><%=  @result.fileObject.createAppName %></creatingApplicationName>
				<creatingApplicationVersion><%= @result.fileObject.createAppVersion %></creatingApplicationVersion>
				<dateCreatedByApplication><%= @result.fileObject.createDate %></dateCreatedByApplication>
			</creatingApplication>
			<% end %>
			<fixity>
				<messageDigestAlgorithm>MD5</messageDigestAlgorithm>
				<messageDigest><%= Digest::MD5.hexdigest(File.read(@result.fileObject.url)) %></messageDigest>
			</fixity>
			<objectCharacteristicsExtension>
				<%= @result.fileObject.objectExtension %>
			</objectCharacteristicsExtension>
			<inhibitors>
				<% @result.fileObject.inhibitors.each do |inh| %>
				<inhibitorType><%= inh.type %></inhibitorType>
				<inhibitorTarget><%= inh.target %></inhibitorTarget>
				<inhibitorKey><%= inh.key %></inhibitorKey>
				<% end %>
			</inhibitors>
		</objectCharacteristics>
	</object>
	<% end %>
	
	<% unless @result.bitstreams.nil? %>
	<!-- generate premis bitstream object -->
	<% @result.bitstreams.each do |bs| %>
	<object xsi:type="bitstream">
		<objectIdentifier>
			<objectIdentifierType>DAITSS</objectIdentifierType>
			<objectIdentifierValue><%= bs.url %></objectIdentifierValue>
		</objectIdentifier>
		<objectCharacteristics>
			<format>
				<% unless bs.formatName.nil? %>
				<formatDesignation>
					<formatName><%= bs.formatName%></formatName>
				</formatDesignation>
				<% end %>
			</format>
			<objectCharacteristicsExtension>
				<%= bs.objectExtension %>
			</objectCharacteristicsExtension>
		</objectCharacteristics>
	</object>
	<% end %>
	<% end %>
	
	<!-- generate premis event -->
	<event>
		<eventIdentifier>
			<eventIdentifierType>Temporary Local</eventIdentifierType>
			<eventIdentifierValue>1</eventIdentifierValue>
		</eventIdentifier>
		<eventType>Format Description</eventType>
		<eventDateTime><%= Time.now %></eventDateTime>
		<eventOutcomeInformation>
			<eventOutcome><%=  @result.status %></eventOutcome>
		</eventOutcomeInformation>
		<eventOutcomeDetail>
			<eventOutcomeDetailExtension>
				<% unless @result.anomaly.nil? %>
				<% @result.anomaly.each do |anomaly| %>
				<anomaly><%= anomaly %></anomaly>
				<% end %>
				<% end %>
			</eventOutcomeDetailExtension>
		</eventOutcomeDetail>
		<linkingAgentIdentifier>
			<linkingAgentIdentifierType>URI</linkingAgentIdentifierType>
			<linkingAgentIdentifierValue>http://archive/format_description</linkingAgentIdentifierValue>
		</linkingAgentIdentifier>
	</event>

<!-- generate premis agent -->
<agent>
	<agentIdentifier>
		<agentIdentifierType>URI</agentIdentifierType>
		<agentIdentifierValue>http://archive/format_description</agentIdentifierValue>
	</agentIdentifier>
	<agentName>Format Description Service</agentName>
	<agentType>Web Service</agentType>
</agent>
</premis>